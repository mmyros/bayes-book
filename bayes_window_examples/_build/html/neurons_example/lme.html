
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Linear mixed effects &#8212; Bayes-window examples</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8e5499552300ddf5d7adccae7cc3b70.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced topics" href="../advanced.html" />
    <link rel="prev" title="Neurons example with stim types" href="stim_type.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Bayes-window examples</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Intro
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../motivation.html">
   Motivation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../motivation/metropolis.html">
     Intuition for maximal likelihood or posterior inference
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../radon_example/radon.html">
     Radon example from Gelman and Hill (2006)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../motivation/multilevel_modeling_lfp.html">
     Multilevel modeling of LFP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../motivation/multilevel_modeling_neurons.html">
     Bayesian Methods for Multilevel Modeling of Neurons
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../lfp.html">
   LFP example
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../lfp_example/quick_lfp.html">
     LFP example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lfp_example/lfp_stim_strength.html">
     LFP example with stim strength
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lfp_example/lfp_roc.html">
     Compare to ANOVA and LMM: ROC curve
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../lfp_example/lfp_slope_vs_means.html">
     LFP example: regression vs estimation of difference
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../neurons.html">
   Neurons example
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="quickstart.html">
     Neurons example, pt. 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="posteriors.html">
     Neurons example, no slopes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="stim_type.html">
     Neurons example with stim types
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Linear mixed effects
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../advanced.html">
   Advanced topics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="monster.html">
     Neurons example, pt. 2: large datasets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="model_comparison.html">
     Compare to alternative models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="detailed_workflow.html">
     Neurons example via low-level, flexible interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="stim_strength.html">
     Neurons example with nominal stim strengths
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/neurons_example/lme.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fneurons_example/lme.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/neurons_example/lme.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lfp">
   LFP
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#with-data-overlay">
   With data overlay
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spikes">
   Spikes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#group-slope">
     Group slope
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical">
     Categorical
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nested">
     Nested
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="linear-mixed-effects">
<h1>Linear mixed effects<a class="headerlink" href="#linear-mixed-effects" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bayes_window</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">BayesWindow</span><span class="p">,</span> <span class="n">LMERegression</span>
<span class="kn">from</span> <span class="nn">bayes_window.generative_models</span> <span class="kn">import</span> <span class="n">generate_fake_spikes</span><span class="p">,</span> <span class="n">generate_fake_lfp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">,</span> <span class="n">df_monster</span><span class="p">,</span> <span class="n">index_cols</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_fake_lfp</span><span class="p">(</span><span class="n">mouse_response_slope</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                                 <span class="n">n_trials</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lfp">
<h2>LFP<a class="headerlink" href="#lfp" title="Permalink to this headline">¶</a></h2>
<p>Without data overlay</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span> <span class="o">=</span> <span class="n">LMERegression</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Log power&#39;</span><span class="p">,</span> <span class="n">treatment</span><span class="o">=</span><span class="s1">&#39;stim&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">)</span>
<span class="n">bw</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bw</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using formula Log_power ~  C(stim, Treatment) + (1 | mouse)
                          Coef.    Std.Err.       z  P&gt;|z|       [0.025  \
Intercept                 0.030                                           
C(stim, Treatment)[T.1]   0.088       0.021   4.162  0.000        0.047   
1 | mouse                -0.173  165065.177  -0.000  1.000  -323521.975   
Group Var                 0.000                                           

                             0.975]  
Intercept                            
C(stim, Treatment)[T.1]       0.130  
1 | mouse                323521.629  
Group Var                            
changing x to :Q
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>changing x to :Q
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/base/model.py:566: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn(&quot;Maximum Likelihood optimization failed to &quot;
/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2200: ConvergenceWarning: Retrying MixedLM optimization with lbfgs
  warnings.warn(
/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2237: ConvergenceWarning: The MLE may be on the boundary of the parameter space.
  warnings.warn(msg, ConvergenceWarning)
/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2261: ConvergenceWarning: The Hessian matrix at the estimated parameter values is not positive definite.
  warnings.warn(msg, ConvergenceWarning)
</pre></div>
</div>
<div class="output text_html">
<div id="altair-viz-e1a7f81b030d4e81bed84f46275b07c3"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e1a7f81b030d4e81bed84f46275b07c3") {
      outputDiv = document.getElementById("altair-viz-e1a7f81b030d4e81bed84f46275b07c3");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "rule", "clip": true, "opacity": 0.4, "size": 0.8}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "lower interval", "scale": {"domain": [0, 0.13], "zero": true}}, "y2": {"field": "higher interval"}}}, {"mark": {"type": "line", "clip": true, "color": "black", "fill": null, "point": false, "size": 1}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "aggregate": "mean", "axis": {"orient": "left"}, "field": "center interval", "scale": {"domain": [0, 0.13], "zero": true}, "title": "\u0394 Log_power"}}}, {"mark": {"type": "line", "color": "black", "opacity": 1, "size": 0.5}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "zero", "scale": {"domain": [0, 0.13], "zero": true}}}}], "data": {"name": "data-bf6c8a6318638cd56cc7764ce782b3ea"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-bf6c8a6318638cd56cc7764ce782b3ea": [{"index": "C(stim, Treatment)[T.1]", "center interval": 0.088, "Std.Err.": 0.021, "z": 4.162, "p": 0.0, "higher interval": 0.047, "lower interval": 0.13, "zero": 0}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">data_and_posterior</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>center interval</th>
      <th>Std.Err.</th>
      <th>z</th>
      <th>p</th>
      <th>higher interval</th>
      <th>lower interval</th>
      <th>zero</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>C(stim, Treatment)[T.1]</td>
      <td>0.088</td>
      <td>0.021</td>
      <td>4.162</td>
      <td>0.0</td>
      <td>0.047</td>
      <td>0.13</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="with-data-overlay">
<h2>With data overlay<a class="headerlink" href="#with-data-overlay" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span> <span class="o">=</span> <span class="n">LMERegression</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Log power&#39;</span><span class="p">,</span> <span class="n">treatment</span><span class="o">=</span><span class="s1">&#39;stim&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">bw</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_make_change</span><span class="o">=</span><span class="s1">&#39;subtract&#39;</span><span class="p">);</span>
    <span class="n">bw</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>    
<span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> Data addition to LME is not implemented&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using formula Log_power ~  C(stim, Treatment) + (1 | mouse)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                          Coef.    Std.Err.       z  P&gt;|z|       [0.025  \
Intercept                 0.030                                           
C(stim, Treatment)[T.1]   0.088       0.021   4.162  0.000        0.047   
1 | mouse                -0.173  165065.177  -0.000  1.000  -323521.975   
Group Var                 0.000                                           

                             0.975]  
Intercept                            
C(stim, Treatment)[T.1]       0.130  
1 | mouse                323521.629  
Group Var                            

 Data addition to LME is not implemented
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/base/model.py:566: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn(&quot;Maximum Likelihood optimization failed to &quot;
/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2200: ConvergenceWarning: Retrying MixedLM optimization with lbfgs
  warnings.warn(
/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2237: ConvergenceWarning: The MLE may be on the boundary of the parameter space.
  warnings.warn(msg, ConvergenceWarning)
/home/m/anaconda3/envs/dj/lib/python3.8/site-packages/statsmodels/regression/mixed_linear_model.py:2261: ConvergenceWarning: The Hessian matrix at the estimated parameter values is not positive definite.
  warnings.warn(msg, ConvergenceWarning)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="spikes">
<h2>Spikes<a class="headerlink" href="#spikes" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">,</span> <span class="n">df_monster</span><span class="p">,</span> <span class="n">index_cols</span><span class="p">,</span> <span class="n">firing_rates</span> <span class="o">=</span> <span class="n">generate_fake_spikes</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                                                <span class="n">n_neurons</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                                                <span class="n">n_mice</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                                                <span class="n">dur</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                                               <span class="n">mouse_response_slope</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                                                               <span class="n">overall_stim_response_strength</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_isi&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;isi&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span> <span class="o">=</span> <span class="n">LMERegression</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;log_isi&#39;</span><span class="p">,</span> <span class="n">treatment</span><span class="o">=</span><span class="s1">&#39;stim&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neuron_x_mouse&#39;</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">,)</span>
<span class="n">bw</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_group_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_group_slope</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using formula log_isi ~ (1|mouse) + stim| neuron_x_mouse__0 + stim|neuron_x_mouse__1 + stim|neuron_x_mouse__2 + stim|neuron_x_mouse__3 + stim|neuron_x_mouse__4 + stim|neuron_x_mouse__5 + stim|neuron_x_mouse__6 + stim|neuron_x_mouse__7 + stim|neuron_x_mouse__8 + stim|neuron_x_mouse__9 + stim|neuron_x_mouse__10 + stim|neuron_x_mouse__11 + stim|neuron_x_mouse__12 + stim|neuron_x_mouse__13 + stim|neuron_x_mouse__14 + stim|neuron_x_mouse__15 + stim|neuron_x_mouse__16 + stim|neuron_x_mouse__17
                            Coef. Std.Err.        z  P&gt;|z|  [0.025  0.975]
Intercept                  -1.047    0.132   -7.947  0.000  -1.305  -0.789
1 | mouse                  -0.079    0.069   -1.143  0.253  -0.213   0.056
stim | neuron_x_mouse__0   -0.010    0.020   -0.486  0.627  -0.049   0.030
stim | neuron_x_mouse__1   -0.074    0.020   -3.692  0.000  -0.114  -0.035
stim | neuron_x_mouse__2   -0.091    0.020   -4.506  0.000  -0.130  -0.051
stim | neuron_x_mouse__3   -0.159    0.020   -7.887  0.000  -0.198  -0.119
stim | neuron_x_mouse__4   -0.226    0.020  -11.249  0.000  -0.266  -0.187
stim | neuron_x_mouse__5   -0.276    0.020  -13.728  0.000  -0.316  -0.237
stim | neuron_x_mouse__6    0.124    0.020    6.166  0.000   0.085   0.164
stim | neuron_x_mouse__7    0.080    0.020    3.988  0.000   0.041   0.120
stim | neuron_x_mouse__8    0.019    0.020    0.967  0.334  -0.020   0.059
stim | neuron_x_mouse__9   -0.003    0.020   -0.126  0.900  -0.042   0.037
stim | neuron_x_mouse__10  -0.045    0.020   -2.213  0.027  -0.084  -0.005
stim | neuron_x_mouse__11  -0.078    0.020   -3.873  0.000  -0.117  -0.039
stim | neuron_x_mouse__12   0.194    0.020    9.641  0.000   0.155   0.233
stim | neuron_x_mouse__13   0.175    0.020    8.707  0.000   0.136   0.215
stim | neuron_x_mouse__14   0.129    0.020    6.409  0.000   0.090   0.168
stim | neuron_x_mouse__15   0.079    0.020    3.914  0.000   0.039   0.118
stim | neuron_x_mouse__16   0.012    0.020    0.576  0.565  -0.028   0.051
stim | neuron_x_mouse__17  -0.021    0.020   -1.027  0.304  -0.060   0.019
Group Var                   0.013    0.203                                
changing x to :Q
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">chart</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-0d381d0bf9b540f5a8e9d5cd21c60f47"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0d381d0bf9b540f5a8e9d5cd21c60f47") {
      outputDiv = document.getElementById("altair-viz-0d381d0bf9b540f5a8e9d5cd21c60f47");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "rule", "clip": true, "opacity": 0.4, "size": 0.8}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "lower interval", "scale": {"domain": [-0.237, 0.155], "zero": true}}, "y2": {"field": "higher interval"}}}, {"mark": {"type": "line", "clip": true, "color": "black", "fill": null, "point": false, "size": 1}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "aggregate": "mean", "axis": {"orient": "left"}, "field": "center interval", "scale": {"domain": [-0.237, 0.155], "zero": true}, "title": "\u0394 log_isi"}}}, {"mark": {"type": "line", "color": "black", "opacity": 1, "size": 0.5}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "zero", "scale": {"domain": [-0.237, 0.155], "zero": true}}}}], "data": {"name": "data-d20699561c871cbe63f0ec333d110bba"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-d20699561c871cbe63f0ec333d110bba": [{"neuron_x_mouse": 0, "center interval": -0.01, "Std.Err.": 0.02, "z": -0.486, "p": 0.627, "higher interval": -0.049, "lower interval": 0.03, "zero": 0}, {"neuron_x_mouse": 1, "center interval": -0.074, "Std.Err.": 0.02, "z": -3.692, "p": 0.0, "higher interval": -0.114, "lower interval": -0.035, "zero": 0}, {"neuron_x_mouse": 2, "center interval": -0.091, "Std.Err.": 0.02, "z": -4.506, "p": 0.0, "higher interval": -0.13, "lower interval": -0.051, "zero": 0}, {"neuron_x_mouse": 3, "center interval": -0.159, "Std.Err.": 0.02, "z": -7.887, "p": 0.0, "higher interval": -0.198, "lower interval": -0.119, "zero": 0}, {"neuron_x_mouse": 4, "center interval": -0.226, "Std.Err.": 0.02, "z": -11.249, "p": 0.0, "higher interval": -0.266, "lower interval": -0.187, "zero": 0}, {"neuron_x_mouse": 5, "center interval": -0.276, "Std.Err.": 0.02, "z": -13.728, "p": 0.0, "higher interval": -0.316, "lower interval": -0.237, "zero": 0}, {"neuron_x_mouse": 6, "center interval": 0.124, "Std.Err.": 0.02, "z": 6.166, "p": 0.0, "higher interval": 0.085, "lower interval": 0.164, "zero": 0}, {"neuron_x_mouse": 7, "center interval": 0.08, "Std.Err.": 0.02, "z": 3.988, "p": 0.0, "higher interval": 0.041, "lower interval": 0.12, "zero": 0}, {"neuron_x_mouse": 8, "center interval": 0.019, "Std.Err.": 0.02, "z": 0.967, "p": 0.334, "higher interval": -0.02, "lower interval": 0.059, "zero": 0}, {"neuron_x_mouse": 9, "center interval": -0.003, "Std.Err.": 0.02, "z": -0.126, "p": 0.9, "higher interval": -0.042, "lower interval": 0.037, "zero": 0}, {"neuron_x_mouse": 10, "center interval": -0.045, "Std.Err.": 0.02, "z": -2.213, "p": 0.027, "higher interval": -0.084, "lower interval": -0.005, "zero": 0}, {"neuron_x_mouse": 11, "center interval": -0.078, "Std.Err.": 0.02, "z": -3.873, "p": 0.0, "higher interval": -0.117, "lower interval": -0.039, "zero": 0}, {"neuron_x_mouse": 12, "center interval": 0.194, "Std.Err.": 0.02, "z": 9.641, "p": 0.0, "higher interval": 0.155, "lower interval": 0.233, "zero": 0}, {"neuron_x_mouse": 13, "center interval": 0.175, "Std.Err.": 0.02, "z": 8.707, "p": 0.0, "higher interval": 0.136, "lower interval": 0.215, "zero": 0}, {"neuron_x_mouse": 14, "center interval": 0.129, "Std.Err.": 0.02, "z": 6.409, "p": 0.0, "higher interval": 0.09, "lower interval": 0.168, "zero": 0}, {"neuron_x_mouse": 15, "center interval": 0.079, "Std.Err.": 0.02, "z": 3.914, "p": 0.0, "higher interval": 0.039, "lower interval": 0.118, "zero": 0}, {"neuron_x_mouse": 16, "center interval": 0.012, "Std.Err.": 0.02, "z": 0.576, "p": 0.565, "higher interval": -0.028, "lower interval": 0.051, "zero": 0}, {"neuron_x_mouse": 17, "center interval": -0.021, "Std.Err.": 0.02, "z": -1.027, "p": 0.304, "higher interval": -0.06, "lower interval": 0.019, "zero": 0}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<div class="section" id="group-slope">
<h3>Group slope<a class="headerlink" href="#group-slope" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span> <span class="o">=</span> <span class="n">LMERegression</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;log_isi&#39;</span><span class="p">,</span> <span class="n">treatment</span><span class="o">=</span><span class="s1">&#39;stim&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neuron_x_mouse&#39;</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">,)</span>
<span class="n">bw</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_group_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_group_slope</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using formula log_isi ~ (stim|mouse)  + stim| neuron_x_mouse__0 + stim|neuron_x_mouse__1 + stim|neuron_x_mouse__2 + stim|neuron_x_mouse__3 + stim|neuron_x_mouse__4 + stim|neuron_x_mouse__5 + stim|neuron_x_mouse__6 + stim|neuron_x_mouse__7 + stim|neuron_x_mouse__8 + stim|neuron_x_mouse__9 + stim|neuron_x_mouse__10 + stim|neuron_x_mouse__11 + stim|neuron_x_mouse__12 + stim|neuron_x_mouse__13 + stim|neuron_x_mouse__14 + stim|neuron_x_mouse__15 + stim|neuron_x_mouse__16 + stim|neuron_x_mouse__17
                            Coef. Std.Err.        z  P&gt;|z|  [0.025  0.975]
Intercept                  -1.102    0.093  -11.904  0.000  -1.284  -0.921
stim | mouse               -0.079    0.069   -1.143  0.253  -0.213   0.056
stim | neuron_x_mouse__0   -0.033    0.029   -1.146  0.252  -0.089   0.023
stim | neuron_x_mouse__1   -0.097    0.029   -3.395  0.001  -0.154  -0.041
stim | neuron_x_mouse__2   -0.114    0.029   -3.966  0.000  -0.170  -0.058
stim | neuron_x_mouse__3   -0.182    0.029   -6.337  0.000  -0.238  -0.126
stim | neuron_x_mouse__4   -0.250    0.029   -8.695  0.000  -0.306  -0.193
stim | neuron_x_mouse__5   -0.299    0.029  -10.434  0.000  -0.356  -0.243
stim | neuron_x_mouse__6    0.180    0.052    3.432  0.001   0.077   0.282
stim | neuron_x_mouse__7    0.136    0.052    2.594  0.009   0.033   0.238
stim | neuron_x_mouse__8    0.075    0.052    1.432  0.152  -0.028   0.178
stim | neuron_x_mouse__9    0.053    0.052    1.012  0.311  -0.050   0.156
stim | neuron_x_mouse__10   0.011    0.052    0.209  0.834  -0.092   0.114
stim | neuron_x_mouse__11  -0.022    0.052   -0.429  0.668  -0.125   0.080
stim | neuron_x_mouse__12   0.171    0.028    6.060  0.000   0.116   0.226
stim | neuron_x_mouse__13   0.152    0.028    5.393  0.000   0.097   0.207
stim | neuron_x_mouse__14   0.106    0.028    3.754  0.000   0.051   0.161
stim | neuron_x_mouse__15   0.056    0.028    1.973  0.049   0.000   0.111
stim | neuron_x_mouse__16  -0.012    0.028   -0.409  0.682  -0.067   0.044
stim | neuron_x_mouse__17  -0.044    0.028   -1.553  0.120  -0.099   0.011
Group Var                   0.013    0.203                                
changing x to :Q
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;bayes_window.lme.LMERegression at 0x7fb304ab6760&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">chart</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div id="altair-viz-5a7f38d45739441d9a80136a34bfb49e"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5a7f38d45739441d9a80136a34bfb49e") {
      outputDiv = document.getElementById("altair-viz-5a7f38d45739441d9a80136a34bfb49e");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "rule", "clip": true, "opacity": 0.4, "size": 0.8}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "lower interval", "scale": {"domain": [-0.243, 0.116], "zero": true}}, "y2": {"field": "higher interval"}}}, {"mark": {"type": "line", "clip": true, "color": "black", "fill": null, "point": false, "size": 1}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "aggregate": "mean", "axis": {"orient": "left"}, "field": "center interval", "scale": {"domain": [-0.243, 0.116], "zero": true}, "title": "\u0394 log_isi"}}}, {"mark": {"type": "line", "color": "black", "opacity": 1, "size": 0.5}, "encoding": {"x": {"type": "quantitative", "field": ""}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "zero", "scale": {"domain": [-0.243, 0.116], "zero": true}}}}], "data": {"name": "data-d94914ea2cc006c2beee6b56b0290069"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-d94914ea2cc006c2beee6b56b0290069": [{"neuron_x_mouse": 0, "center interval": -0.033, "Std.Err.": 0.029, "z": -1.146, "p": 0.252, "higher interval": -0.089, "lower interval": 0.023, "zero": 0}, {"neuron_x_mouse": 1, "center interval": -0.097, "Std.Err.": 0.029, "z": -3.395, "p": 0.001, "higher interval": -0.154, "lower interval": -0.041, "zero": 0}, {"neuron_x_mouse": 2, "center interval": -0.114, "Std.Err.": 0.029, "z": -3.966, "p": 0.0, "higher interval": -0.17, "lower interval": -0.058, "zero": 0}, {"neuron_x_mouse": 3, "center interval": -0.182, "Std.Err.": 0.029, "z": -6.337, "p": 0.0, "higher interval": -0.238, "lower interval": -0.126, "zero": 0}, {"neuron_x_mouse": 4, "center interval": -0.25, "Std.Err.": 0.029, "z": -8.695, "p": 0.0, "higher interval": -0.306, "lower interval": -0.193, "zero": 0}, {"neuron_x_mouse": 5, "center interval": -0.299, "Std.Err.": 0.029, "z": -10.434, "p": 0.0, "higher interval": -0.356, "lower interval": -0.243, "zero": 0}, {"neuron_x_mouse": 6, "center interval": 0.18, "Std.Err.": 0.052, "z": 3.432, "p": 0.001, "higher interval": 0.077, "lower interval": 0.282, "zero": 0}, {"neuron_x_mouse": 7, "center interval": 0.136, "Std.Err.": 0.052, "z": 2.594, "p": 0.009, "higher interval": 0.033, "lower interval": 0.238, "zero": 0}, {"neuron_x_mouse": 8, "center interval": 0.075, "Std.Err.": 0.052, "z": 1.432, "p": 0.152, "higher interval": -0.028, "lower interval": 0.178, "zero": 0}, {"neuron_x_mouse": 9, "center interval": 0.053, "Std.Err.": 0.052, "z": 1.012, "p": 0.311, "higher interval": -0.05, "lower interval": 0.156, "zero": 0}, {"neuron_x_mouse": 10, "center interval": 0.011, "Std.Err.": 0.052, "z": 0.209, "p": 0.834, "higher interval": -0.092, "lower interval": 0.114, "zero": 0}, {"neuron_x_mouse": 11, "center interval": -0.022, "Std.Err.": 0.052, "z": -0.429, "p": 0.668, "higher interval": -0.125, "lower interval": 0.08, "zero": 0}, {"neuron_x_mouse": 12, "center interval": 0.171, "Std.Err.": 0.028, "z": 6.06, "p": 0.0, "higher interval": 0.116, "lower interval": 0.226, "zero": 0}, {"neuron_x_mouse": 13, "center interval": 0.152, "Std.Err.": 0.028, "z": 5.393, "p": 0.0, "higher interval": 0.097, "lower interval": 0.207, "zero": 0}, {"neuron_x_mouse": 14, "center interval": 0.106, "Std.Err.": 0.028, "z": 3.754, "p": 0.0, "higher interval": 0.051, "lower interval": 0.161, "zero": 0}, {"neuron_x_mouse": 15, "center interval": 0.056, "Std.Err.": 0.028, "z": 1.973, "p": 0.049, "higher interval": 0.0, "lower interval": 0.111, "zero": 0}, {"neuron_x_mouse": 16, "center interval": -0.012, "Std.Err.": 0.028, "z": -0.409, "p": 0.682, "higher interval": -0.067, "lower interval": 0.044, "zero": 0}, {"neuron_x_mouse": 17, "center interval": -0.044, "Std.Err.": 0.028, "z": -1.553, "p": 0.12, "higher interval": -0.099, "lower interval": 0.011, "zero": 0}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;neuron_x_mouse:O&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>changing x to neuron_x_mouse:Q
</pre></div>
</div>
<div class="output text_html">
<div id="altair-viz-28b8a1d307c2421a872d0d5f43fa0838"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-28b8a1d307c2421a872d0d5f43fa0838") {
      outputDiv = document.getElementById("altair-viz-28b8a1d307c2421a872d0d5f43fa0838");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "rule", "clip": true, "opacity": 0.4, "size": 0.8}, "encoding": {"x": {"type": "quantitative", "field": "neuron_x_mouse"}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "lower interval", "scale": {"domain": [-0.243, 0.116], "zero": true}}, "y2": {"field": "higher interval"}}}, {"mark": {"type": "line", "clip": true, "color": "black", "fill": null, "point": false, "size": 1}, "encoding": {"x": {"type": "quantitative", "field": "neuron_x_mouse"}, "y": {"type": "quantitative", "aggregate": "mean", "axis": {"orient": "left"}, "field": "center interval", "scale": {"domain": [-0.243, 0.116], "zero": true}, "title": "\u0394 log_isi"}}}, {"mark": {"type": "line", "color": "black", "opacity": 1, "size": 0.5}, "encoding": {"x": {"type": "quantitative", "field": "neuron_x_mouse"}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "zero", "scale": {"domain": [-0.243, 0.116], "zero": true}}}}], "data": {"name": "data-d94914ea2cc006c2beee6b56b0290069"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-d94914ea2cc006c2beee6b56b0290069": [{"neuron_x_mouse": 0, "center interval": -0.033, "Std.Err.": 0.029, "z": -1.146, "p": 0.252, "higher interval": -0.089, "lower interval": 0.023, "zero": 0}, {"neuron_x_mouse": 1, "center interval": -0.097, "Std.Err.": 0.029, "z": -3.395, "p": 0.001, "higher interval": -0.154, "lower interval": -0.041, "zero": 0}, {"neuron_x_mouse": 2, "center interval": -0.114, "Std.Err.": 0.029, "z": -3.966, "p": 0.0, "higher interval": -0.17, "lower interval": -0.058, "zero": 0}, {"neuron_x_mouse": 3, "center interval": -0.182, "Std.Err.": 0.029, "z": -6.337, "p": 0.0, "higher interval": -0.238, "lower interval": -0.126, "zero": 0}, {"neuron_x_mouse": 4, "center interval": -0.25, "Std.Err.": 0.029, "z": -8.695, "p": 0.0, "higher interval": -0.306, "lower interval": -0.193, "zero": 0}, {"neuron_x_mouse": 5, "center interval": -0.299, "Std.Err.": 0.029, "z": -10.434, "p": 0.0, "higher interval": -0.356, "lower interval": -0.243, "zero": 0}, {"neuron_x_mouse": 6, "center interval": 0.18, "Std.Err.": 0.052, "z": 3.432, "p": 0.001, "higher interval": 0.077, "lower interval": 0.282, "zero": 0}, {"neuron_x_mouse": 7, "center interval": 0.136, "Std.Err.": 0.052, "z": 2.594, "p": 0.009, "higher interval": 0.033, "lower interval": 0.238, "zero": 0}, {"neuron_x_mouse": 8, "center interval": 0.075, "Std.Err.": 0.052, "z": 1.432, "p": 0.152, "higher interval": -0.028, "lower interval": 0.178, "zero": 0}, {"neuron_x_mouse": 9, "center interval": 0.053, "Std.Err.": 0.052, "z": 1.012, "p": 0.311, "higher interval": -0.05, "lower interval": 0.156, "zero": 0}, {"neuron_x_mouse": 10, "center interval": 0.011, "Std.Err.": 0.052, "z": 0.209, "p": 0.834, "higher interval": -0.092, "lower interval": 0.114, "zero": 0}, {"neuron_x_mouse": 11, "center interval": -0.022, "Std.Err.": 0.052, "z": -0.429, "p": 0.668, "higher interval": -0.125, "lower interval": 0.08, "zero": 0}, {"neuron_x_mouse": 12, "center interval": 0.171, "Std.Err.": 0.028, "z": 6.06, "p": 0.0, "higher interval": 0.116, "lower interval": 0.226, "zero": 0}, {"neuron_x_mouse": 13, "center interval": 0.152, "Std.Err.": 0.028, "z": 5.393, "p": 0.0, "higher interval": 0.097, "lower interval": 0.207, "zero": 0}, {"neuron_x_mouse": 14, "center interval": 0.106, "Std.Err.": 0.028, "z": 3.754, "p": 0.0, "higher interval": 0.051, "lower interval": 0.161, "zero": 0}, {"neuron_x_mouse": 15, "center interval": 0.056, "Std.Err.": 0.028, "z": 1.973, "p": 0.049, "higher interval": 0.0, "lower interval": 0.111, "zero": 0}, {"neuron_x_mouse": 16, "center interval": -0.012, "Std.Err.": 0.028, "z": -0.409, "p": 0.682, "higher interval": -0.067, "lower interval": 0.044, "zero": 0}, {"neuron_x_mouse": 17, "center interval": -0.044, "Std.Err.": 0.028, "z": -1.553, "p": 0.12, "higher interval": -0.099, "lower interval": 0.011, "zero": 0}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
</div>
<div class="section" id="categorical">
<h3>Categorical<a class="headerlink" href="#categorical" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;log_isi ~ (1|mouse) + C(stim| neuron_x_mouse)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using formula log_isi ~ (1|mouse) + C(stim| neuron_x_mouse)
                                 Coef.    Std.Err.       z  P&gt;|z|  \
Intercept                       -0.768  153525.798  -0.000  1.000   
C(stim | neuron_x_mouse)[T.1]   -0.086       0.029  -3.015  0.003   
C(stim | neuron_x_mouse)[T.2]   -0.081       0.035  -2.302  0.021   
C(stim | neuron_x_mouse)[T.3]   -0.156       0.029  -5.427  0.000   
C(stim | neuron_x_mouse)[T.4]   -0.217       0.035  -6.164  0.000   
C(stim | neuron_x_mouse)[T.5]   -0.237       0.029  -8.242  0.000   
C(stim | neuron_x_mouse)[T.6]   -0.024       0.161  -0.151  0.880   
C(stim | neuron_x_mouse)[T.7]   -0.294       0.160  -1.840  0.066   
C(stim | neuron_x_mouse)[T.8]   -0.129       0.161  -0.800  0.423   
C(stim | neuron_x_mouse)[T.9]   -0.255       0.160  -1.599  0.110   
C(stim | neuron_x_mouse)[T.10]  -0.193       0.161  -1.198  0.231   
C(stim | neuron_x_mouse)[T.11]  -0.236       0.160  -1.475  0.140   
C(stim | neuron_x_mouse)[T.12]   0.543  307051.595   0.000  1.000   
C(stim | neuron_x_mouse)[T.13]   0.186  307051.595   0.000  1.000   
C(stim | neuron_x_mouse)[T.14]   0.478  307051.595   0.000  1.000   
C(stim | neuron_x_mouse)[T.15]   0.281  307051.595   0.000  1.000   
C(stim | neuron_x_mouse)[T.16]   0.361  307051.595   0.000  1.000   
C(stim | neuron_x_mouse)[T.17]   0.320  307051.595   0.000  1.000   
1 | mouse                       -0.288  153525.798  -0.000  1.000   
Group Var                        0.012       2.932                  

                                     [0.025      0.975]  
Intercept                       -300905.802  300904.266  
C(stim | neuron_x_mouse)[T.1]        -0.143      -0.030  
C(stim | neuron_x_mouse)[T.2]        -0.150      -0.012  
C(stim | neuron_x_mouse)[T.3]        -0.212      -0.099  
C(stim | neuron_x_mouse)[T.4]        -0.286      -0.148  
C(stim | neuron_x_mouse)[T.5]        -0.293      -0.180  
C(stim | neuron_x_mouse)[T.6]        -0.340       0.291  
C(stim | neuron_x_mouse)[T.7]        -0.607       0.019  
C(stim | neuron_x_mouse)[T.8]        -0.445       0.187  
C(stim | neuron_x_mouse)[T.9]        -0.569       0.058  
C(stim | neuron_x_mouse)[T.10]       -0.509       0.123  
C(stim | neuron_x_mouse)[T.11]       -0.549       0.077  
C(stim | neuron_x_mouse)[T.12]  -601809.525  601810.611  
C(stim | neuron_x_mouse)[T.13]  -601809.883  601810.254  
C(stim | neuron_x_mouse)[T.14]  -601809.590  601810.546  
C(stim | neuron_x_mouse)[T.15]  -601809.788  601810.349  
C(stim | neuron_x_mouse)[T.16]  -601809.708  601810.429  
C(stim | neuron_x_mouse)[T.17]  -601809.749  601810.388  
1 | mouse                       -300905.322  300904.746  
Group Var                                                
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>changing x to :Q
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;bayes_window.lme.LMERegression at 0x7fb304ab6760&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;neuron_x_mouse:O&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>changing x to neuron_x_mouse:Q
</pre></div>
</div>
<div class="output text_html">
<div id="altair-viz-e2485f87f3af415e98f0ff1ab4c744b9"></div>
<script type="text/javascript">
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e2485f87f3af415e98f0ff1ab4c744b9") {
      outputDiv = document.getElementById("altair-viz-e2485f87f3af415e98f0ff1ab4c744b9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.8.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function loadScript(lib) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = paths[lib];
        s.async = true;
        s.onload = () => resolve(paths[lib]);
        s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
        document.getElementsByTagName("head")[0].appendChild(s);
      });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else if (typeof vegaEmbed === "function") {
      displayChart(vegaEmbed);
    } else {
      loadScript("vega")
        .then(() => loadScript("vega-lite"))
        .then(() => loadScript("vega-embed"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "rule", "clip": true, "opacity": 0.4, "size": 0.8}, "encoding": {"x": {"type": "quantitative", "field": "neuron_x_mouse"}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "lower interval", "scale": {"domain": [-0.18, 0], "zero": true}}, "y2": {"field": "higher interval"}}}, {"mark": {"type": "line", "clip": true, "color": "black", "fill": null, "point": false, "size": 1}, "encoding": {"x": {"type": "quantitative", "field": "neuron_x_mouse"}, "y": {"type": "quantitative", "aggregate": "mean", "axis": {"orient": "left"}, "field": "center interval", "scale": {"domain": [-0.18, 0], "zero": true}, "title": "\u0394 log_isi"}}}, {"mark": {"type": "line", "color": "black", "opacity": 1, "size": 0.5}, "encoding": {"x": {"type": "quantitative", "field": "neuron_x_mouse"}, "y": {"type": "quantitative", "axis": {"orient": "left", "title": ""}, "field": "zero", "scale": {"domain": [-0.18, 0], "zero": true}}}}], "data": {"name": "data-90e3efc634234f9fadf5d686855f6b6d"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.8.1.json", "datasets": {"data-90e3efc634234f9fadf5d686855f6b6d": [{"neuron_x_mouse": 0, "center interval": -0.086, "Std.Err.": 0.029, "z": -3.015, "p": 0.003, "higher interval": -0.143, "lower interval": -0.03, "zero": 0}, {"neuron_x_mouse": 1, "center interval": -0.081, "Std.Err.": 0.035, "z": -2.302, "p": 0.021, "higher interval": -0.15, "lower interval": -0.012, "zero": 0}, {"neuron_x_mouse": 2, "center interval": -0.156, "Std.Err.": 0.029, "z": -5.427, "p": 0.0, "higher interval": -0.212, "lower interval": -0.099, "zero": 0}, {"neuron_x_mouse": 3, "center interval": -0.217, "Std.Err.": 0.035, "z": -6.164, "p": 0.0, "higher interval": -0.286, "lower interval": -0.148, "zero": 0}, {"neuron_x_mouse": 4, "center interval": -0.237, "Std.Err.": 0.029, "z": -8.242, "p": 0.0, "higher interval": -0.293, "lower interval": -0.18, "zero": 0}, {"neuron_x_mouse": 5, "center interval": -0.024, "Std.Err.": 0.161, "z": -0.151, "p": 0.88, "higher interval": -0.34, "lower interval": 0.291, "zero": 0}, {"neuron_x_mouse": 6, "center interval": -0.294, "Std.Err.": 0.16, "z": -1.84, "p": 0.066, "higher interval": -0.607, "lower interval": 0.019, "zero": 0}, {"neuron_x_mouse": 7, "center interval": -0.129, "Std.Err.": 0.161, "z": -0.8, "p": 0.423, "higher interval": -0.445, "lower interval": 0.187, "zero": 0}, {"neuron_x_mouse": 8, "center interval": -0.255, "Std.Err.": 0.16, "z": -1.599, "p": 0.11, "higher interval": -0.569, "lower interval": 0.058, "zero": 0}, {"neuron_x_mouse": 9, "center interval": -0.193, "Std.Err.": 0.161, "z": -1.198, "p": 0.231, "higher interval": -0.509, "lower interval": 0.123, "zero": 0}, {"neuron_x_mouse": 10, "center interval": -0.236, "Std.Err.": 0.16, "z": -1.475, "p": 0.14, "higher interval": -0.549, "lower interval": 0.077, "zero": 0}, {"neuron_x_mouse": 11, "center interval": 0.543, "Std.Err.": 307051.595, "z": 0.0, "p": 1.0, "higher interval": -601809.525, "lower interval": 601810.611, "zero": 0}, {"neuron_x_mouse": 12, "center interval": 0.186, "Std.Err.": 307051.595, "z": 0.0, "p": 1.0, "higher interval": -601809.883, "lower interval": 601810.254, "zero": 0}, {"neuron_x_mouse": 13, "center interval": 0.478, "Std.Err.": 307051.595, "z": 0.0, "p": 1.0, "higher interval": -601809.59, "lower interval": 601810.546, "zero": 0}, {"neuron_x_mouse": 14, "center interval": 0.281, "Std.Err.": 307051.595, "z": 0.0, "p": 1.0, "higher interval": -601809.788, "lower interval": 601810.349, "zero": 0}, {"neuron_x_mouse": 15, "center interval": 0.361, "Std.Err.": 307051.595, "z": 0.0, "p": 1.0, "higher interval": -601809.708, "lower interval": 601810.429, "zero": 0}, {"neuron_x_mouse": 16, "center interval": 0.32, "Std.Err.": 307051.595, "z": 0.0, "p": 1.0, "higher interval": -601809.749, "lower interval": 601810.388, "zero": 0}]}}, {"mode": "vega-lite"});
</script></div></div>
</div>
</div>
<div class="section" id="nested">
<h3>Nested<a class="headerlink" href="#nested" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bw</span> <span class="o">=</span> <span class="n">LMERegression</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;log_isi&#39;</span><span class="p">,</span> <span class="n">treatment</span><span class="o">=</span><span class="s1">&#39;stim&#39;</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;neuron_x_mouse&#39;</span><span class="p">],</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;mouse&#39;</span><span class="p">,)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">bw</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">add_data</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_group_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_group_slope</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_nested_group</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using formula log_isi ~ (stim|mouse) + stim| neuron_x_mouse__0:mouse + stim|neuron_x_mouse__1:mouse + stim|neuron_x_mouse__2:mouse + stim|neuron_x_mouse__3:mouse + stim|neuron_x_mouse__4:mouse + stim|neuron_x_mouse__5:mouse + stim|neuron_x_mouse__6:mouse + stim|neuron_x_mouse__7:mouse + stim|neuron_x_mouse__8:mouse + stim|neuron_x_mouse__9:mouse + stim|neuron_x_mouse__10:mouse + stim|neuron_x_mouse__11:mouse + stim|neuron_x_mouse__12:mouse + stim|neuron_x_mouse__13:mouse + stim|neuron_x_mouse__14:mouse + stim|neuron_x_mouse__15:mouse + stim|neuron_x_mouse__16:mouse + stim|neuron_x_mouse__17:mouse
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Singular matrix
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "pycharm-d5912792"
        },
        kernelOptions: {
            kernelName: "pycharm-d5912792",
            path: "./neurons_example"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'pycharm-d5912792'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="stim_type.html" title="previous page">Neurons example with stim types</a>
    <a class='right-next' id="next-link" href="../advanced.html" title="next page">Advanced topics</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Max Myroshnychenko<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>